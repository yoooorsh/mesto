(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._settingsObj=e,this._form=n,this._buttonElement=this._getSubmitBtn(),this._fieldsetList=this._getFieldsetList()}var n,r;return n=t,(r=[{key:"_showInputError",value:function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(this._settingsObj.inputErrorClass),r.textContent=n,r.classList.add(this._settingsObj.errorClass)}},{key:"_hideInputError",value:function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._settingsObj.inputErrorClass),n.classList.remove(this._settingsObj.errorClass),n.textContent=""}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_checkInputValidity",value:function(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}},{key:"_toggleButtonState",value:function(e){this._hasInvalidInput(e)?(this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._settingsObj.inactiveButtonClass)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._settingsObj.inactiveButtonClass))}},{key:"_setEventListeners",value:function(e){var t=this,n=Array.from(e.querySelectorAll(this._settingsObj.inputSelector));this._toggleButtonState(n),n.forEach((function(r){r.addEventListener("input",(function(){t._checkInputValidity(e,r),t._toggleButtonState(n)}))}))}},{key:"enableValidation",value:function(){var e=this;document.querySelector(this._settingsObj.openFormBtnSelector).addEventListener("click",(function(){e._resetError()})),this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._fieldsetList.forEach((function(t){e._setEventListeners(t)}))}},{key:"_getFieldsetList",value:function(){return Array.from(this._form.querySelectorAll(this._settingsObj.fieldsetSelector))}},{key:"_getSubmitBtn",value:function(){return this._form.querySelector(this._settingsObj.submitButtonSelector)}},{key:"_resetError",value:function(){var e=this;this._fieldsetList.forEach((function(t){var n=Array.from(t.querySelectorAll(e._settingsObj.inputSelector));e._toggleButtonState(n),n.forEach((function(n){e._hideInputError(t,n)}))}))}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var t,r;return t=e,(r=[{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"setUserInfo",value:function(e,t){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"addNewCard",value:function(e,t){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"setLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"removeLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}},{key:"setAvatarPhoto",value:function(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).catch((function(e){throw Error("Api error: ".concat(e))}))}}])&&n(t.prototype,r),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-24",headers:{authorization:"febe2ee3-a098-4028-9a86-63d42bc45ba2","Content-Type":"application/json"}});function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n,r,o,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var c=t.name,a=t.link,u=t.likes,l=t._id,f=t.owner;this._name=c,this._link=a,this._likeCount=u.length,this._cardId=l,this._owner=f,this._templateSelector=n,this._handleCardClick=r,this._handleCardDelete=o,this._isShowDeleteBtn=i,this._isActiveLikeBtn=s,this._handleLikeButtonActive=this._handleLikeButtonActive.bind(this),this._handleLikeButtonInactive=this._handleLikeButtonInactive.bind(this)}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".elements__element").cloneNode(!0)}},{key:"createCard",value:function(){return this._cardElement=this._getTemplate(),this._cardElement.id=this._cardId,this._cardElement.querySelector(".elements__name").textContent=this._name,this._cardElement.querySelector(".elements__photo").src=this._link,this._cardElement.querySelector(".elements__photo").alt=this._name,this._cardElement.querySelector(".elements__like-counter").textContent=this._likeCount,this._isShowDeleteBtn?this._setEventListenersDeleteBtn():this._cardElement.querySelector(".elements__delete-button").remove(),this._isActiveLikeBtn?(this._cardElement.querySelector(".elements__like-button").classList.add("elements__like-button_active"),this._setEventListenersActiveLikeBtn()):this._setEventListenersInactiveLikeBtn(),this._setEventListenersCardPhoto(),this._cardElement}},{key:"_setEventListenersInactiveLikeBtn",value:function(){this._cardElement.querySelector(".elements__like-button").addEventListener("click",this._handleLikeButtonActive,{once:!0})}},{key:"_setEventListenersActiveLikeBtn",value:function(){this._cardElement.querySelector(".elements__like-button").addEventListener("click",this._handleLikeButtonInactive,{once:!0})}},{key:"_setEventListenersDeleteBtn",value:function(){this._cardElement.querySelector(".elements__delete-button").addEventListener("click",this._handleCardDelete)}},{key:"_setEventListenersCardPhoto",value:function(){var e=this;this._cardElement.querySelector(".elements__photo").addEventListener("click",(function(){e._handleCardClick(e._name,e._link)}))}},{key:"_handleLikeButtonActive",value:function(){var e=this;r.setLike(this._cardId).then((function(t){e._updateLikes(t.likes.length),e._setEventListenersActiveLikeBtn()}))}},{key:"_handleLikeButtonInactive",value:function(){var e=this;r.removeLike(this._cardId).then((function(t){e._updateLikes(t.likes.length),e._setEventListenersInactiveLikeBtn()}))}},{key:"_updateLikes",value:function(e){var t=this._cardElement.querySelector(".elements__like-button"),n=this._cardElement.querySelector(".elements__like-counter");t.classList.toggle("elements__like-button_active"),n.textContent=e}}])&&o(t.prototype,n),e}(),s={formSelector:".popup__container",fieldsetSelector:".popup__fieldset",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup_save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_show"},c=".profile__edit-button",a=".popup_content_edit-profile",u=".profile__name",l=".profile__profession",f=document.querySelector(".popup__input_content_name"),h=document.querySelector(".popup__input_content_profession"),p=document.querySelector(a).querySelector(".popup__container"),_=".profile__avatar-edit-button",d=".profile__photo",v=".popup_content_edit-avatar",y=document.querySelector(".popup__input_content_avatar-url"),m=document.querySelector(v).querySelector(".popup__container"),b=".profile__add-button",E=".popup_content_add-element",k=document.querySelector(".popup__input_content_place"),S=document.querySelector(".popup__input_content_img-url"),L=document.querySelector(E).querySelector(".popup__container");function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this.open=this.open.bind(this),this.close=this.close.bind(this),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this),this.setEventListeners=this.setEventListeners.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_visible"),document.addEventListener("keydown",this._handleEscClose),document.addEventListener("click",this._handleOverlayClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_visible"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("click",this._handleOverlayClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleOverlayClose",value:function(e){e.target.classList.contains("popup")&&this.close()}},{key:"setEventListeners",value:function(e){this._popup.querySelector(".popup__close-button").addEventListener("click",e)}}])&&g(t.prototype,n),e}();function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?B(e):t}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(r);if(o){var n=I(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return q(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e))._formSubmit=t,n._popup=document.querySelector(e),n._form=n._popup.querySelector(".popup__container"),n.open=n.open.bind(B(n)),n.close=n.close.bind(B(n)),n._data=null,n._submitBtn=n._popup.querySelector(".popup__save-button"),n._btnName=n._submitBtn.textContent,n}return t=s,(n=[{key:"setEventListeners",value:function(){var e=this;C(I(s.prototype),"setEventListeners",this).call(this,this.close),this._form.addEventListener("submit",(function(t){return e._formSubmit(t,e._data)}))}},{key:"close",value:function(){this._form.reset(),this._data=null,C(I(s.prototype),"close",this).call(this)}},{key:"open",value:function(e){this._data=e,C(I(s.prototype),"open",this).call(this)}},{key:"viewLoader",value:function(e){this._submitBtn.textContent=e?"Сохранение...":this._btnName}}])&&j(t.prototype,n),s}(w);function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=N(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=N(r);if(o){var n=N(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return R(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=i.call(this,e))._popupPhoto=document.querySelector(".popup__photo"),t._popupPhotoName=document.querySelector(".popup__photo-name"),t}return t=s,(n=[{key:"open",value:function(e,t){this._popupPhoto.src=t,this._popupPhoto.alt=e,this._popupPhotoName.textContent=e,D(N(s.prototype),"open",this).call(this)}},{key:"setEventListeners",value:function(){D(N(s.prototype),"setEventListeners",this).call(this,this.close)}}])&&U(t.prototype,n),s}(w);function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.append(e)}},{key:"addItemToStart",value:function(e){this._container.prepend(e)}},{key:"clear",value:function(){this._container.innerHTML=""}},{key:"renderItems",value:function(){var e=this;this.clear(),this._renderedItems.forEach((function(t){e._renderer(t)}))}}])&&V(t.prototype,n),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameElement=document.querySelector(t),this._professionElement=document.querySelector(n),this._avatarPhotoElement=document.querySelector(r)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._nameElement.textContent,profession:this._professionElement.textContent,photoLink:this._avatarPhotoElement.src}}},{key:"setUserInfo",value:function(e,t){this._nameElement.textContent=e,this._professionElement.textContent=t}},{key:"setAvatarPhoto",value:function(e){this._avatarPhotoElement.src=e}}])&&J(t.prototype,n),e}();function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q,W,X=new t(G(G({},s),{},{openFormBtnSelector:c}),p),Y=new t(G(G({},s),{},{openFormBtnSelector:b}),L),Z=new t(G(G({},s),{},{openFormBtnSelector:_}),m),$=new M(u,l,d),ee=new F(".popup_content_view-photo");r.getInitialCards().then((function(e){(Q=new H({items:e,renderer:function(e){var t=ie(e);Q.addItem(t)}},".elements")).renderItems()}));var te=new A(a,(function(e){e.preventDefault(),te.viewLoader(!0),r.setUserInfo(f.value,h.value).then((function(e){$.setUserInfo(e.name,e.about),te.close()})).finally((function(){return te.viewLoader(!1)}))})),ne=new A(E,(function(e){e.preventDefault(),ne.viewLoader(!0),r.addNewCard(k.value,S.value).then((function(e){var t=ie(e);Q.addItemToStart(t),ne.close()})).finally((function(){return ne.viewLoader(!1)}))})),re=new A(".popup_content_delete-confirmation",(function(e,t){e.preventDefault(),re.viewLoader(!0);var n=t._id;n&&r.deleteCard(n).then((function(){document.getElementById(n).remove(),re.close()})).finally((function(){return re.viewLoader(!1)}))})),oe=new A(v,(function(e){e.preventDefault(),r.setAvatarPhoto(y.value).then((function(e){$.setAvatarPhoto(e.avatar),oe.close()}))}));function ie(e){var t=e.likes,n=e.owner._id===W,r=t.some((function(e){return e._id===W}));return new i(e,"#element",ee.open,(function(){return re.open(e)}),n,r).createCard()}ee.setEventListeners(),te.setEventListeners(),ne.setEventListeners(),re.setEventListeners(),oe.setEventListeners(),r.getUserInfo().then((function(e){document.querySelector(u).textContent=e.name,document.querySelector(l).textContent=e.about,document.querySelector(d).src=e.avatar,W=e._id})),document.querySelector(c).addEventListener("click",(function(){te.open();var e=$.getUserInfo(),t=e.name,n=e.profession;f.value=t,h.value=n})),document.querySelector(b).addEventListener("click",(function(){ne.open()})),document.querySelector(_).addEventListener("click",(function(){oe.open();var e=$.getUserInfo().photoLink;y.value=e})),X.enableValidation(),Y.enableValidation(),Z.enableValidation()})();